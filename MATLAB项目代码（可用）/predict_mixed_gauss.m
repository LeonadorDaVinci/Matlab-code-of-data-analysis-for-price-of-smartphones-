function yhat = predict_mixed_gauss(x_orig)
% PREDICT_MIXED_GAUSS 预测函数（自动生成）
% 输入 x_orig: N x p 原始特征（与 mixed_reg_gauss_fit 中的特征顺序一致）
% 输出 yhat: N x 1 预测值

% ---- 固定参数（由拟合结果生成） ----
a = 630302896.762832;
b = [-0.00163646811195226 0.733336584558299 -0.122197210597425 1.23353289682355 -0.0392926682885572 -0.00929273181033015 -0.00397158961488205 0.00461538441521948 1.00378235884682 0.0824418095372634];
c = [-66.6517045022925 0.0596632030658548 -0.798674037531528 -0.441447702870861 -6.96005352967645 -36.3334236434144 4.81770641467344 -82.0321304667485 0.238284007450673 -4.24998870279332];
w = [-96.0088337775998 420.794088339697 159.478876236698 -29.9019939556884 223.016378112636 68.4002418802102 421.515322695873 -8.01511927116669 -478.938145680471 -87.9281860551721 618.62976256289 -56.1001943423329 325.648889815336 -300.956716339797 -218.034977584391 -150.233524652311 142.945166134412];
bias = 1984.50741192576;

muX = [0.43103448275862 1.05420689655172 0.922413793103448 1.6551724137931 1.1046394984326 1.10641926187903 0.698275862068966 2.04094827586207 1.42322634706211 0.972413793103448 0.657931034482759 0.172413793103448 0.206896551724138 0.137931034482759 0.103448275862069 0.137931034482759 0.206896551724138];
sigmaX = [0.269395418716829 0.772768556153335 0.533910139392213 0.711555743673452 0.122610898366836 0.504767779642794 0.225389646192627 1.70912694580359 0.395599870511473 0.584306600692204 0.337251276714144 0.384425872219245 0.412250820394885 0.350931203171798 0.309934046694603 0.350931203171798 0.412250820394885];

coeff = [-0.281795189107526 0.270052734735978 0.311889385991416 -0.0141427492796974 -0.0610557545702666 -0.0515645882489605 0.198988099055474 -0.0435844550670894 0.0404827957767315 -0.312279420733492 -0.0611855145979782 0.674107526708581 -0.223145160868147 0.146160080207685 0.207657859742164 0.170210321798586 0.0416367005844366;0.186538149216886 -0.467668378858391 -0.158522035239164 -0.0508661183756685 -0.0191249741511504 -0.199212698476299 -0.241497090702924 0.486713306686292 0.0122719264529695 -0.0890962291586055 -0.00164084233288762 0.464159049528168 -0.0987080401171249 -0.0581774898835521 -0.134393010775992 -0.294193019049823 0.205516646250744;0.315552263479923 -0.00567708180381261 0.0341917791837815 -0.267628396618651 -0.116808603951909 -0.103017625786364 -0.170353605322581 -0.307273464836658 0.0211046415963834 0.480597545929751 -0.397332406579692 0.198137057695764 0.114553053677859 0.136252530898576 0.450747605027789 -0.094841151650926 0.0866033794154877;0.352089365688878 -0.0677742865518588 0.147806956410201 -0.0559912775724288 0.024221768147288 0.100728677513179 -0.19772669262224 0.185530110579246 0.10527127433591 -0.0683363984202051 0.0615492744535726 -0.0325020994841189 0.100508938476754 0.643200395999405 -0.176520308681202 0.53470079678809 -0.0271627667020213;0.329190850595665 0.107763341716265 0.0603921103017588 0.138290362348326 0.118537907967098 -0.112196642877112 -0.117993521736432 -0.212104708880198 -0.283321178055154 -0.142641820369679 0.486449028695953 0.255877351094691 0.519439545455042 -0.27066985353371 0.105270559002756 0.103479698173247 0.0640765874980772;0.223730205133604 -0.212357412851039 0.404548398513171 0.0566422319449308 0.0422097636165576 0.0344357129504609 -0.354412116946109 -0.473096842601454 0.236994145708393 -0.181865565794435 -0.0431554208361821 -0.00969313372269103 -0.380964217249049 -0.266838307147109 -0.24542305528778 -0.0161199228343207 -0.132510076881615;0.300112462710601 -0.160745542450588 0.0871980965692719 0.00565580008621687 -0.151733566169634 -0.0284900898316205 0.47581883218643 -0.059116547163881 -0.0380642061215336 -0.453185499923089 -0.48377109633316 -0.0585170488072028 0.352769482798397 0.0011620320674513 -0.137325322988622 -0.149857119747959 -0.11259235272862;0.287584332388637 0.232201516737672 0.0199071127599781 0.0123157508312617 0.0842537222832262 -0.0794606686141111 0.455399752103752 -0.0447570367463117 0.424966876000132 0.382267427053323 0.270332805826558 0.203038064657514 -0.0441507395965495 0.0684004553865767 -0.377167472721137 -0.222430520183582 -0.0252360936254148;0.329292601515387 0.227810010442082 -0.0211799549369641 0.0656143373558669 -0.0121473543329712 0.120085960301835 0.0168127996377126 -0.0737043321639079 -0.378073383846953 -0.230505093536601 0.183299384355126 -0.16367205997176 -0.397937501439059 0.367321810613934 0.149974118305371 -0.460248398101637 0.17484928973407;0.299733323725645 0.213899692185491 -0.127105050459583 0.00523569819039919 -0.110876658627412 -0.14457970568326 -0.000348110751660719 0.261656285311547 0.540580758705552 -0.275643989397355 0.0686673570954895 -0.225681249313538 -0.117287199362783 -0.254686654555343 0.470761150949294 0.13101510202444 0.0728402172923106;-0.305966923433609 0.0616338103636865 0.315119612885482 0.101782602321676 0.0171974064424301 0.0680966482728149 -0.282919849652486 0.00350428941642478 0.395817222884944 -0.119805154363095 0.0576978667911515 -0.099364422696335 0.438859492907631 0.26246884306307 0.0419094765351667 -0.466388339879404 0.207238277812886;-0.170170025651574 -0.334347660790751 -0.314890545598211 -0.200813413945729 0.12888861504103 -0.361594210109506 0.184525779552781 -0.457493741038318 0.14404529611418 -0.187947720320087 0.173352539364921 -0.095392001288592 -0.0414138495418295 0.211282059758995 0.00985751182260139 0.124755754580833 0.414509677347366;0.0422756734411403 0.501115361699307 -0.121757158602715 -0.454827153074821 0.270096435373132 0.0505022157722325 -0.2092096724252 0.033887297478476 -0.0425239713704469 -0.145987309323347 -0.281672032714645 0.00222835356440258 0.0480186355550906 -0.180763304369255 -0.368976575438603 0.0380314844746372 0.360483109027988;0.0773598795472829 -0.183367102779166 0.331767699364988 0.265725841927647 0.646752720625328 0.120638930731907 0.23589602230658 0.157313220283073 -0.0473009898571125 0.147842680903894 -0.170408500952906 -0.0854791127498632 -0.0639557829937401 -0.0976064230563403 0.192575879786935 0.0975907243943125 0.381847294829837;0.0237160306754465 -0.217938796898314 0.0905507137510878 -0.309994468368591 -0.365411570819178 0.685568617886023 0.177739055249938 -0.0171446122867461 0.0478572375633036 0.0308370520717809 0.2177163718197 0.0415644899248248 0.023605886993801 -0.172477299067177 0.037583202116421 0.0636704995907346 0.352261014821143;-0.022637576984805 0.0633925152725419 0.485274323586954 -0.0306153887559198 -0.442377310808111 -0.49328196076244 0.0596284743921464 0.15691145669898 -0.211759992140031 0.164348754719373 0.050836539817505 -0.245971850744773 -0.0495688848448729 -0.0923932013361848 -0.15277602922712 0.0951918761998861 0.33690357794759;0.0369703447121913 0.133316720515214 -0.309236904056204 0.685861642318512 -0.293099192820758 0.121859774889672 -0.108190746136964 -0.155064745235079 0.0665928576379426 0.063649724315337 -0.24274669512454 0.115628579316677 -0.00761523143720439 0.00532628900813235 -0.167666122401491 0.143238749530073 0.385773877499458];

usePCA = true;

if isempty(x_orig)
    yhat = [];
    return;
end

if size(x_orig,2) == 1
    x_orig = x_orig'; % ensure row vector
end

% 标准化原始特征
if ~isempty(muX)
    Xn = (x_orig - muX) ./ sigmaX; % N x p
else
    Xn = x_orig; % assume already standardized
end

if usePCA
    % 将原始标准化特征映射到 PCA 空间（与训练时一致）
    m_gauss = 10;
    Z = (Xn * coeff(:,1:m_gauss)); % N x m
else
    Z = Xn; % N x m
end

% 计算 Gaussian 部分
b = b(:)'; c = c(:)'; % ensure row
G = a * exp( - sum( (Z - c).^2 .* (ones(size(Z,1),1) * b), 2) );

% 计算线性部分
L = Xn * w(:) + bias;

yhat = G + L;
end
